from IPython.display import JSON
import json
import pandas as pd
import requests

# These are only the very first hours from 07:00 till 19:00
# Between 00:00 and 07:00 there were no flights found in Berlin.

url_one = "https://aerodatabox.p.rapidapi.com/flights/airports/icao/EDDB/2021-11-25T07:00/2021-11-25T19:00"

querystring = {"direction":"Arrival","withPrivate":"true"}

headers = {
    'x-rapidapi-host': "aerodatabox.p.rapidapi.com",
    'x-rapidapi-key': "d60bcb4130msh4eef02db400fd9fp125f8ejsnb836c3b3a687"
    }

response_one = requests.request("GET", url_one, headers=headers, params=querystring)

print(response_one.text)

# Between 19:01 and 23:59
url_two = "https://aerodatabox.p.rapidapi.com/flights/airports/icao/EDDB/2021-11-25T19:01/2021-11-25T23:59"

querystring = {"direction":"Arrival","withPrivate":"true"}

response_two = requests.request("GET", url_two, headers=headers, params=querystring)
print(response_two.text)

# flights between 07:00 - 19:00
JSON(response_one.json())

# flights between 19:01-23:59
JSON(response_two.json())

# creating a list with the responses of json
List_of_responses = [response_one.json(),response_two.json()]

# for our data frame we need to know what info to include. so :
# icao : the first 2 letters indicate the country and the 2 last identifies the airport
# scheduleTimeLocal : time of arrival in local time
# number : number of flight
# Airline : the name of the company responsible for the scheduled flight

dictionary = {"From":[],"Arrival at : ":[], "Terminal":[],"Airline":[],"Flight number":[],"Airport code":[]}

# As I understand it ,the "movement" represents the "departure"

for resp in List_of_responses:
    for flight in resp['arrivals']:
        try:
            dictionary["From"].append(flight['movement']["airport"]['name'])
        except:
            dictionary["From"].append("Unknown")
        try:
            dictionary["Arrival at : "].append(flight['movement']['scheduledTimeLocal'][:-6])
        except:
            dictionary["Arrival at : "].append("Unknown")
        try:
            dictionary["Terminal"].append(flight['movement']['terminal'])
        except:
            dictionary["Terminal"].append("Unknown")
        try:
            dictionary["Airline"].append(flight['airline']['name'])
        except:
            dictionary["Airline"].append("Unknown")
        try:
            dictionary["Flight number"].append(flight['number'])
        except:
            dictionary["Flight number"].append("Unknown")
        try:
            dictionary["Airport code"].append(flight['movement']["airport"]["icao"])
        except:
            dictionary["Airport code"].append("Unknown")
            
flights = pd.DataFrame.from_dict(dictionary)
flights